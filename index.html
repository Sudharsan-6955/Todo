<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TO-DO</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2906/2906274.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="toDo.css">
</head>

<body>
    <div class="app">
        <h1 class="app-title"><i class="fa fa-list-check"></i> To Do</h1>

        <div class="input-wrap">
            <input type="text" name="Tasks" id="newTask" placeholder="Add a new task..." />
            <button type="submit" id="submit" aria-label="Add task"><i class="fa fa-plus"></i> Add</button>
        </div>

        <h2 class="section-title">Tasks</h2>
        <ul id="Tasks" class="tasks-list">
            <h1>Tasks</h1>
        </ul>

        <h2 class="section-title">Completed</h2>
        <ul id="doneTask" class="done-list">

        </ul>
    </div>

</body>
<script>
    // let username = prompt('Hey Hii!! Your Wonderfull NAME ?')
    let username = "";

    while (!username) {
        username = prompt('Hey Hii!! Your Wonderfull NAME ?')

        if (username == null) username = ""
    }

    alert("Welcome " + username + "!");


    let submit = document.getElementById('submit')
    let newTask = document.getElementById('newTask')
    let tasks = document.getElementById('Tasks')
    let doneTask = document.getElementById('doneTask')

    let storage = new Array()
    let completedTasks = new Array()

    // Load tasks from local storage
    function loadTasks() {
        const savedTasks = localStorage.getItem('todoTasks')
        const savedCompleted = localStorage.getItem('completedTasks')
        
        if (savedTasks) {
            storage = JSON.parse(savedTasks)
            renderTasks()
        }
        
        if (savedCompleted) {
            completedTasks = JSON.parse(savedCompleted)
            renderCompletedTasks()
        }
    }

    // Save tasks to local storage
    function saveTasks() {
        localStorage.setItem('todoTasks', JSON.stringify(storage))
        localStorage.setItem('completedTasks', JSON.stringify(completedTasks))
    }

    // Render active tasks
    function renderTasks() {
        const completedSet = new Set(completedTasks)
        const tasksHTML = ['<h1>Tasks</h1>']
        
        storage.forEach((task, index) => {
            if (task !== null && !completedSet.has(index)) {
                tasksHTML.push(`<li id=${index}><button onclick=complete(${index})><i class="fa fa-circle-play"></i> ${task}</button></li>`)
            }
        })
        
        tasks.innerHTML = tasksHTML.join('')
    }

    // Render completed tasks
    function renderCompletedTasks() {
        const completedHTML = []
        
        completedTasks.forEach(index => {
            if (storage[index]) {
                completedHTML.push(`<li>${storage[index]}</li>`)
            }
        })
        
        doneTask.innerHTML = completedHTML.join('')
    }

    submit.addEventListener('click', (event) => {
        if (newTask.value != '') {
            storage.push(newTask.value)
            console.log(newTask.value)
            saveTasks()
            renderTasks()
            newTask.value = ''
        }
        else {
            alert('Fill the field before submit')
        }
    })

    function complete(id) {
        if (!completedTasks.includes(id)) {
            completedTasks.push(id)
            saveTasks()
            renderTasks()
            renderCompletedTasks()
        }
    }

    // Load tasks when page loads
    loadTasks()
</script>

</html>
