<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TO-DO</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2906/2906274.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="toDo.css">
    <style>
        .custom-alert-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .custom-alert-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideDown 0.3s ease;
        }

        .custom-alert-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .custom-alert-icon.warning { color: #ff9800; }
        .custom-alert-icon.success { color: #4caf50; }
        .custom-alert-icon.info { color: #2196f3; }

        .custom-alert-message {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
        }

        .custom-alert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .custom-alert-btn:hover {
            transform: scale(1.05);
        }

        .custom-prompt-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            animation: slideDown 0.3s ease;
        }

        .custom-prompt-title {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
            text-align: left;
        }

        .custom-prompt-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            margin-bottom: 20px;
            box-sizing: border-box;
            outline: none;
        }

        .custom-prompt-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .custom-prompt-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .custom-prompt-btn {
            padding: 10px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .custom-prompt-btn.ok {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .custom-prompt-btn.cancel {
            background: #f0f0f0;
            color: #333;
        }

        .custom-prompt-btn:hover {
            transform: scale(1.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { 
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to { 
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <h1 class="app-title"><i class="fa fa-list-check"></i> To Do</h1>

        <div class="input-wrap">
            <input type="text" name="Tasks" id="newTask" placeholder="Add a new task..." />
            <button type="submit" id="submit" aria-label="Add task"><i class="fa fa-plus"></i> Add</button>
        </div>

        <h2 class="section-title">Tasks</h2>
        <ul id="Tasks" class="tasks-list">
            <h1>Tasks</h1>
        </ul>

        <h2 class="section-title">Completed</h2>
        <ul id="doneTask" class="done-list">

        </ul>
    </div>

    <!-- Custom Alert -->
    <div id="customAlertOverlay" class="custom-alert-overlay" onclick="closeAlert()">
        <div class="custom-alert-box" onclick="event.stopPropagation()">
            <div id="alertIcon" class="custom-alert-icon"></div>
            <div id="alertMessage" class="custom-alert-message"></div>
            <button class="custom-alert-btn" onclick="closeAlert()">OK</button>
        </div>
    </div>

    <!-- Custom Prompt -->
    <div id="customPromptOverlay" class="custom-alert-overlay">
        <div class="custom-prompt-box" onclick="event.stopPropagation()">
            <div id="promptTitle" class="custom-prompt-title"></div>
            <input type="text" id="promptInput" class="custom-prompt-input" />
            <div class="custom-prompt-buttons">
                <button class="custom-prompt-btn cancel" onclick="closePrompt(null)">Cancel</button>
                <button class="custom-prompt-btn ok" onclick="submitPrompt()">OK</button>
            </div>
        </div>
    </div>

</body>
<script>
    // Custom Alert Function
    function showAlert(message, type = 'info') {
        const overlay = document.getElementById('customAlertOverlay');
        const icon = document.getElementById('alertIcon');
        const msgElement = document.getElementById('alertMessage');
        
        msgElement.textContent = message;
        
        // Set icon based on type
        if (type === 'warning') {
            icon.innerHTML = '<i class="fa fa-exclamation-triangle warning"></i>';
        } else if (type === 'success') {
            icon.innerHTML = '<i class="fa fa-check-circle success"></i>';
        } else {
            icon.innerHTML = '<i class="fa fa-info-circle info"></i>';
        }
        
        overlay.style.display = 'block';
    }

    function closeAlert() {
        document.getElementById('customAlertOverlay').style.display = 'none';
    }

    // Custom Prompt Function
    let promptResolve = null;

    function showPrompt(message) {
        return new Promise((resolve) => {
            promptResolve = resolve;
            const overlay = document.getElementById('customPromptOverlay');
            const title = document.getElementById('promptTitle');
            const input = document.getElementById('promptInput');
            
            title.textContent = message;
            input.value = '';
            overlay.style.display = 'block';
            input.focus();
            
            // Allow Enter key to submit
            input.onkeypress = (e) => {
                if (e.key === 'Enter') submitPrompt();
            };
        });
    }

    function submitPrompt() {
        const input = document.getElementById('promptInput');
        const value = input.value;
        closePrompt(value);
    }

    function closePrompt(value) {
        document.getElementById('customPromptOverlay').style.display = 'none';
        if (promptResolve) {
            promptResolve(value);
            promptResolve = null;
        }
    }

    // let username = prompt('Hey Hii!! Your Wonderfull NAME ?')
    let username = "";

    async function getUserName() {
        // Check if username is already saved in local storage
        const savedUsername = localStorage.getItem('username');
        
        if (savedUsername) {
            username = savedUsername;
            showAlert("Welcome back " + username + "!", 'success');
        } else {
            while (!username) {
                username = await showPrompt('Hey Hii!! Your Wonderfull NAME ?');
                if (username == null) username = "";
            }
            // Save username to local storage
            localStorage.setItem('username', username);
            showAlert("Welcome " + username + "!", 'success');
        }
    }

    getUserName();


    let submit = document.getElementById('submit')
    let newTask = document.getElementById('newTask')
    let tasks = document.getElementById('Tasks')
    let doneTask = document.getElementById('doneTask')

    let storage = new Array()
    let completedTasks = new Array()

    // Load tasks from local storage
    function loadTasks() {
        const savedTasks = localStorage.getItem('todoTasks')
        const savedCompleted = localStorage.getItem('completedTasks')
        
        if (savedTasks) {
            storage = JSON.parse(savedTasks)
            renderTasks()
        }
        
        if (savedCompleted) {
            completedTasks = JSON.parse(savedCompleted)
            renderCompletedTasks()
        }
    }

    // Save tasks to local storage
    function saveTasks() {
        localStorage.setItem('todoTasks', JSON.stringify(storage))
        localStorage.setItem('completedTasks', JSON.stringify(completedTasks))
    }

    // Render active tasks
    function renderTasks() {
        const completedSet = new Set(completedTasks)
        const tasksHTML = ['<h1>Tasks</h1>']
        
        storage.forEach((task, index) => {
            if (task !== null && !completedSet.has(index)) {
                tasksHTML.push(`<li id=${index}><button onclick=complete(${index})><i class="fa fa-circle-play"></i> ${task}</button></li>`)
            }
        })
        
        tasks.innerHTML = tasksHTML.join('')
    }

    // Render completed tasks
    function renderCompletedTasks() {
        const completedHTML = []
        
        completedTasks.forEach(index => {
            if (storage[index]) {
                completedHTML.push(`<li>${storage[index]}</li>`)
            }
        })
        
        doneTask.innerHTML = completedHTML.join('')
    }

    submit.addEventListener('click', (event) => {
        if (newTask.value != '') {
            storage.push(newTask.value)
            console.log(newTask.value)
            saveTasks()
            renderTasks()
            newTask.value = ''
        }
        else {
            showAlert('Fill the field before submit', 'warning')
        }
    })

    function complete(id) {
        if (!completedTasks.includes(id)) {
            completedTasks.push(id)
            saveTasks()
            renderTasks()
            renderCompletedTasks()
        }
    }

    // Load tasks when page loads
    loadTasks()
</script>

</html>
